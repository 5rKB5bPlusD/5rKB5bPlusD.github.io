<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>整理文件</title>
    <url>/uTools/collating-documents/</url>
    <content><![CDATA[<p>uTools官网 <a href="http://www.u.tools/">http://www.u.tools/</a></p>
<p><img src="https://api.onedrive.com/v1.0/shares/s!AmIICgBbPfPTjmX8t0IZiK-Zl-uR/root/content"></p>
<center style="font-size:14px;color:#C0C0C0;text-decoration:underline">快捷命令-整理文件</center>
<br/>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件整理工具</span></span><br><span class="line"><span class="comment"> * 需要安装7z，设置环境变量 https://www.7-zip.org/</span></span><br><span class="line"><span class="comment"> * 需要cmdutils支持回收文件 http://www.maddogsw.com/cmdutils/</span></span><br><span class="line"><span class="comment"> * 以上两个工具都要配置在环境变量中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//文件整理配置</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="string">&#x27;.*&#x27;</span>: <span class="string">&#x27;D:/xxx/archive/杂项&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.*发票|行程.*&#x27;</span>: <span class="string">&#x27;D:/xxx/archive/报销&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logPath = path.<span class="title function_">join</span>(os.<span class="title function_">tmpdir</span>(), <span class="string">&#x27;history.log&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> payload = &#123;&#123;payload&#125;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logPath)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取文件夹大小</span></span><br><span class="line"><span class="keyword">const</span> getSize = <span class="keyword">function</span>(<span class="params">nowPath</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> size = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> files = fs.<span class="title function_">readdirSync</span>(nowPath)</span><br><span class="line">    files.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">fileName, index</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(fileName, index)</span><br><span class="line">        <span class="keyword">const</span> filePath = nowPath + <span class="string">&#x27;/&#x27;</span> + fileName</span><br><span class="line">        <span class="keyword">const</span> file = fs.<span class="title function_">statSync</span>(filePath)</span><br><span class="line">        <span class="keyword">if</span> (file.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">            size += <span class="title function_">getSize</span>(filePath)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            size += file.<span class="property">size</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示执行的操作</span></span><br><span class="line"><span class="keyword">const</span> show = <span class="keyword">function</span>(<span class="params">showList</span>) &#123;</span><br><span class="line">    quickcommand.<span class="title function_">showSelectList</span>(showList, &#123; <span class="attr">optionType</span>: <span class="string">&#x27;json&#x27;</span> &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">        utools.<span class="title function_">copyText</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(choice))</span><br><span class="line">        utools.<span class="title function_">shellOpenPath</span>(logPath)</span><br><span class="line">        <span class="title function_">show</span>(showList)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> showList = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = payload.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">    obj[<span class="string">&#x27;title&#x27;</span>] = payload[i].<span class="property">name</span></span><br><span class="line">    obj[<span class="string">&#x27;description&#x27;</span>] = payload[i].<span class="property">path</span> + <span class="string">&#x27; 正在执行中...&#x27;</span></span><br><span class="line">    showList.<span class="title function_">push</span>(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">show</span>(showList)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> logMsg = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">let</span> destPaths = []</span><br><span class="line"><span class="keyword">let</span> recyclePaths = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = payload.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> fileName = payload[i].<span class="property">name</span></span><br><span class="line">    <span class="keyword">let</span> filePath = payload[i].<span class="property">path</span></span><br><span class="line">    <span class="comment">// let fileCollationConf = JSON.parse(utools.dbStorage.getItem(&#x27;file_collation_conf&#x27;))</span></span><br><span class="line">    <span class="keyword">let</span> fileCollationConf = config</span><br><span class="line">    <span class="keyword">let</span> destPath = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> fileCollationConf) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileName.<span class="title function_">match</span>(i) != <span class="literal">null</span> &amp;&amp; i != <span class="string">&#x27;.*&#x27;</span>) &#123;</span><br><span class="line">            destPath = fileCollationConf[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (destPath == <span class="literal">null</span> || destPath == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        destPath = fileCollationConf[<span class="string">&#x27;.*&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (destPath == <span class="literal">null</span> || destPath == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">        obj[<span class="string">&#x27;title&#x27;</span>] = fileName</span><br><span class="line">        obj[<span class="string">&#x27;description&#x27;</span>] = filePath + <span class="string">&#x27; =&gt; 未匹配到规则&#x27;</span></span><br><span class="line">        showList[i] = obj</span><br><span class="line">        quickcommand.<span class="title function_">updateSelectList</span>(obj, i)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (payload[i].<span class="property">isDirectory</span>) &#123;</span><br><span class="line">        destPath = path.<span class="title function_">join</span>(destPath, fileName + <span class="string">&#x27;.7z&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(destPath)) &#123;</span><br><span class="line">            destPath = destPath.<span class="title function_">slice</span>(<span class="number">0</span>, destPath.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + fileName + <span class="string">&#x27;_&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="string">&#x27;.7z&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//计算预计时间</span></span><br><span class="line">        <span class="keyword">let</span> size = <span class="title function_">getSize</span>(filePath)</span><br><span class="line">        <span class="keyword">let</span> expect = (size / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">20</span> * <span class="number">1000</span>).<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">        obj[<span class="string">&#x27;title&#x27;</span>] = fileName</span><br><span class="line">        obj[<span class="string">&#x27;description&#x27;</span>] = filePath + <span class="string">&#x27; =&gt; 文件夹压缩中，预计耗时&#x27;</span> + expect + <span class="string">&#x27;ms&#x27;</span></span><br><span class="line">        showList[i] = obj</span><br><span class="line">        quickcommand.<span class="title function_">updateSelectList</span>(obj, i)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要安装7z并配置环境变量</span></span><br><span class="line">        child_process.<span class="title function_">exec</span>(<span class="string">&#x27;7z a &quot;&#x27;</span> + destPath + <span class="string">&#x27;&quot; &quot;&#x27;</span> + filePath + <span class="string">&#x27;&quot;&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">(<span class="params">code</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (code == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">                obj[<span class="string">&#x27;title&#x27;</span>] = fileName</span><br><span class="line">                obj[<span class="string">&#x27;description&#x27;</span>] = filePath + <span class="string">&#x27; =&gt; &#x27;</span> + destPath</span><br><span class="line">                showList[i] = obj</span><br><span class="line">                quickcommand.<span class="title function_">updateSelectList</span>(obj, i)</span><br><span class="line">                <span class="comment">// utools.showNotification(filePath + &#x27; =&gt; &#x27; + destPath)</span></span><br><span class="line">                <span class="comment">//没有cmdutils工具注释掉下面代码</span></span><br><span class="line">                child_process.<span class="title function_">exec</span>(<span class="string">&#x27;Recycle.exe &quot;&#x27;</span> + filePath + <span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                destPath = <span class="string">&#x27;err code: &#x27;</span> + code</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        destPath = path.<span class="title function_">join</span>(destPath, fileName)</span><br><span class="line">        <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(destPath)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileName.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;.&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> onlyName = fileName.<span class="title function_">substring</span>(<span class="number">0</span>, fileName.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;.&#x27;</span>))</span><br><span class="line">                <span class="keyword">const</span> suffix = fileName.<span class="title function_">substr</span>(fileName.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;.&#x27;</span>))</span><br><span class="line">                destPath = destPath.<span class="title function_">slice</span>(<span class="number">0</span>, destPath.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + onlyName + <span class="string">&#x27;_&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + suffix</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                destPath = destPath.<span class="title function_">slice</span>(<span class="number">0</span>, destPath.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;\\&#x27;</span>) + <span class="number">1</span>) + fileName + <span class="string">&#x27;_&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fs.<span class="title function_">writeFileSync</span>(destPath, fs.<span class="title function_">readFileSync</span>(filePath))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">        obj[<span class="string">&#x27;title&#x27;</span>] = fileName</span><br><span class="line">        obj[<span class="string">&#x27;description&#x27;</span>] = filePath + <span class="string">&#x27; =&gt; &#x27;</span> + destPath</span><br><span class="line">        showList[i] = obj</span><br><span class="line">        quickcommand.<span class="title function_">updateSelectList</span>(obj, i)</span><br><span class="line">        <span class="comment">// utools.showNotification(filePath + &#x27; =&gt; &#x27; + destPath)</span></span><br><span class="line">        <span class="comment">//没有cmdutils工具注释掉下面代码</span></span><br><span class="line">        child_process.<span class="title function_">exec</span>(<span class="string">&#x27;Recycle.exe &quot;&#x27;</span> + filePath + <span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    logMsg += date.<span class="title function_">toLocaleDateString</span>() + <span class="string">&#x27; &#x27;</span> + date.<span class="title function_">toLocaleTimeString</span>() + <span class="string">&#x27; &#x27;</span> + filePath + <span class="string">&#x27;-----&gt;&#x27;</span> + destPath + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(logPath)) &#123;</span><br><span class="line">    fs.<span class="title function_">appendFileSync</span>(logPath, logMsg)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fs.<span class="title function_">writeFile</span>(logPath, logMsg, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line">utools.<span class="title function_">showNotification</span>(<span class="string">&#x27;整理完成&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>uTools</category>
      </categories>
  </entry>
  <entry>
    <title>get参数解析成json</title>
    <url>/uTools/get-argument-parsing/</url>
    <content><![CDATA[<p>uTools官网 <a href="http://www.u.tools/">http://www.u.tools/</a></p>
<p><img src="https://api.onedrive.com/v1.0/shares/s!AmIICgBbPfPTjmdJt05MEH3YBeWI/root/content"></p>
<center style="font-size:14px;color:#C0C0C0;text-decoration:underline">快捷命令-get参数解析成json</center>
<br/>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> input = quickcommand.<span class="property">enterData</span>.<span class="property">payload</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (input.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> url = input.<span class="title function_">substring</span>(<span class="number">0</span>, input.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>))</span><br><span class="line">    obj[<span class="string">&#x27;url&#x27;</span>] = url</span><br><span class="line">    <span class="keyword">let</span> param = input.<span class="title function_">substr</span>(input.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> arr = param.<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> tempObj = &#123;&#125;</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> tempArr = value.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (tempArr.<span class="property">length</span> == <span class="number">2</span>) &#123;</span><br><span class="line">            tempObj[tempArr[<span class="number">0</span>]] = tempArr[<span class="number">1</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tempObj[tempArr[<span class="number">0</span>]] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    obj[<span class="string">&#x27;param&#x27;</span>] = tempObj</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = input.<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> tempObj = &#123;&#125;</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> tempArr = value.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (tempArr.<span class="property">length</span> == <span class="number">2</span>) &#123;</span><br><span class="line">            tempObj[tempArr[<span class="number">0</span>]] = tempArr[<span class="number">1</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tempObj[tempArr[<span class="number">0</span>]] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    obj[<span class="string">&#x27;param&#x27;</span>] = tempObj</span><br><span class="line">&#125;</span><br><span class="line">utools.<span class="title function_">copyText</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj))</span><br><span class="line">utools.<span class="title function_">redirect</span>(<span class="string">&#x27;json&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>uTools</category>
      </categories>
  </entry>
  <entry>
    <title>sql日志自动拼接</title>
    <url>/uTools/sql-log-automatic-stitching/</url>
    <content><![CDATA[<p>uTools官网 <a href="http://www.u.tools/">http://www.u.tools/</a></p>
<p><img src="https://api.onedrive.com/v1.0/shares/s!AmIICgBbPfPTjmiViXlRo261rW17/root/content"></p>
<center style="font-size:14px;color:#C0C0C0;text-decoration:underline">快捷命令-sql日志自动拼接</center>
<br/>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> input = <span class="string">`&#123;&#123;payload&#125;&#125;`</span></span><br><span class="line"><span class="keyword">let</span> sql = input.<span class="title function_">slice</span>(input.<span class="title function_">indexOf</span>(<span class="string">&#x27;Preparing:&#x27;</span>) + <span class="number">11</span>, input.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;DEBUG&#x27;</span>) - <span class="number">24</span>)</span><br><span class="line"><span class="keyword">let</span> params = input.<span class="title function_">slice</span>(input.<span class="title function_">indexOf</span>(<span class="string">&#x27;Parameters:&#x27;</span>) + <span class="number">12</span>)</span><br><span class="line"><span class="keyword">if</span> (sql == <span class="string">&#x27;&#x27;</span> || params == <span class="string">&#x27;&#x27;</span>) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">let</span> sqlArr = sql.<span class="title function_">split</span>(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> paramArr = params.<span class="title function_">split</span>(<span class="string">&#x27;, &#x27;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="title function_">replace</span>(<span class="regexp">/.(?&lt;=\()(?!.*\().*/</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">trim</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sqlArr.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sqlArr[i].<span class="title function_">endsWith</span>(<span class="string">&#x27;limit &#x27;</span>) || sqlArr[i].<span class="title function_">endsWith</span>(<span class="string">&#x27;LIMIT &#x27;</span>)) &#123;</span><br><span class="line">        res = res + sqlArr[i] + paramArr[i]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res = res + sqlArr[i] + <span class="string">&#x27;\&#x27;&#x27;</span> + paramArr[i] + <span class="string">&#x27;\&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">res += sqlArr[sqlArr.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> (!res.<span class="title function_">endsWith</span>(<span class="string">&#x27;;&#x27;</span>)) &#123;</span><br><span class="line">    res += <span class="string">&#x27;;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">utools.<span class="title function_">copyText</span>(res)</span><br><span class="line">utools.<span class="title function_">showNotification</span>(<span class="string">&#x27;已复制结果&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>uTools</category>
      </categories>
  </entry>
</search>
